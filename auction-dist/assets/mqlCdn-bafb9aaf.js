import{am as e,ai as t,an as a}from"./index-4336d1e5.js";const n=window.app;class d{constructor(){this.fileName="",this.formData=new FormData,this.formData.set("enctype","multipart/form-data"),this.clientId="",this.bucketId="",this.isPrivateBucket=!1,this.cdnURL="",this.cdnPath="",this.directoryPath="",this.forceCreateDirectory=!0,this.showPageLoader=!1,this.GateWayConfigObj={},this.savedConfig={},this.mainStore=e();let d=t.CancelToken;const i=t.create({baseURL:n.getCDNBaseURL()}),r=(e={})=>(e.Authorization="Bearer "+sessionStorage.getItem("user-token"),this.directoryPath&&(e.directoryPath=this.directoryPath),e),o=e=>{this.formData.append("BucketId",this.bucketId),this.formData.append("JWTKey",e.jwtKey),this.formData.append("IsPrivateBucket",e.isPrivateBucket),this.formData.append("forceCreateDirectory",this.forceCreateDirectory)},s=(e,t,n,o)=>new Promise((t=>{if(void 0!==this.bucketId){if(""===this.formData.get("filename")){null!==n&&null!==document.getElementById(n)&&(document.getElementById(n).disabled=!1,document.getElementById(n).innerHTML=o);let e={data:{}};return e.data.error="File name is required",e.data.errorCode=1990,e.data.result=null,t(new a(e))}i({url:this.cdnURL,method:e,headers:r(),data:this.formData,cancelToken:new d((function(e){}))}).then((e=>{let d={data:{}};d.data.errorCode=1e3,d.data.result=e.data.result,1e3!==e.data.errorCode&&(d.data.errorCode=e.data.errorCode,d.data.error=e.data.error,this.showPageLoader&&this.mainStore.MUTATE_PAGE_BLOCKER(!1),null!==n&&null!==document.getElementById(n)&&(document.getElementById(n).disabled=!1,document.getElementById(n).innerHTML=o)),t(new a(d))})).catch((e=>{console.log("fail error",e.message);let d={data:{}};null!==n&&null!==document.getElementById(n)&&(document.getElementById(n).disabled=!1,document.getElementById(n).innerHTML=o),this.showPageLoader&&this.mainStore.MUTATE_PAGE_BLOCKER(!1),d.data.error=e.message,d.data.errorCode=1990,d.data.result=null,t(new a(d))}))}else{null!==n&&null!==document.getElementById(n)&&(document.getElementById(n).disabled=!1,document.getElementById(n).innerHTML=o);let e={data:{}};e.data.error="Invalid Bucket Key "+this.bucketId,e.data.errorCode=1990,e.data.result=null,t(new a(e))}})).catch((e=>{alert(e)})),l=(e,t,n,o)=>new Promise((t=>{if(void 0!==this.bucketId){if(this.savedConfig.maxFileSize&&this.formData.get("file")&&this.formData.get("file").size>this.savedConfig.maxFileSize){null!==n&&null!==document.getElementById(n)&&(document.getElementById(n).disabled=!1,document.getElementById(n).innerHTML=o);let e={data:{}};return e.data.error="File size exceeds the maximum limit of "+this.savedConfig.maxFileSize/1048576+" MB.",e.data.errorCode=1990,e.data.result=null,t(new a(e))}i({url:this.cdnURL,method:e,headers:r(),data:this.formData,cancelToken:new d((function(e){}))}).then((e=>{let d={data:{}};d.data.errorCode=1e3,d.data.result=e.data.result,1e3!==e.data.errorCode&&(d.data.errorCode=e.data.errorCode,d.data.error=e.data.error,this.showPageLoader&&this.mainStore.MUTATE_PAGE_BLOCKER(!1),null!==n&&null!==document.getElementById(n)&&(document.getElementById(n).disabled=!1,document.getElementById(n).innerHTML=o)),t(new a(d))})).catch((e=>{console.log("fail error",e.message);let d={data:{}};null!==n&&null!==document.getElementById(n)&&(document.getElementById(n).disabled=!1,document.getElementById(n).innerHTML=o),this.showPageLoader&&this.mainStore.MUTATE_PAGE_BLOCKER(!1),d.data.error=e.message,d.data.errorCode=1990,d.data.result=null,t(new a(d))}))}else{null!==n&&null!==document.getElementById(n)&&(document.getElementById(n).disabled=!1,document.getElementById(n).innerHTML=o);let e={data:{}};e.data.error="Invalid Bucket Key "+this.bucketId,e.data.errorCode=1990,e.data.result=null,t(new a(e))}})).catch((e=>{alert(e)})),h=(e=null,t="")=>{let a="";return this.showPageLoader&&this.mainStore.MUTATE_PAGE_BLOCKER(!0),new Promise((t=>{null!==e&&null!==document.getElementById(e)&&(a=document.getElementById(e).innerHTML,document.getElementById(e).disabled=!0,document.getElementById(e).innerHTML="Processing"),s("DELETE",0,e,a).then((n=>{this.showPageLoader&&this.mainStore.MUTATE_PAGE_BLOCKER(!1),null!==e&&null!==document.getElementById(e)&&(document.getElementById(e).disabled=!1,document.getElementById(e).innerHTML=a),t(n)}))})).catch((e=>{console.log(e),alert(e)}))},m=(e=null,t="")=>{let a="";return this.showPageLoader&&this.mainStore.MUTATE_PAGE_BLOCKER(!0),new Promise((t=>{null!==e&&null!==document.getElementById(e)&&(a=document.getElementById(e).innerHTML,document.getElementById(e).disabled=!0,document.getElementById(e).innerHTML="Processing"),l("POST",0,e,a).then((n=>{this.showPageLoader&&this.mainStore.MUTATE_PAGE_BLOCKER(!1),null!==e&&null!==document.getElementById(e)&&(document.getElementById(e).disabled=!1,document.getElementById(e).innerHTML=a),t(n)}))})).catch((e=>{console.log(e),alert(e)}))};this.setFileName=e=>(""!==e&&void 0!==e?(this.fileName=e.trim(),this.formData.append("fileName",this.fileName)):this.fileName="",this),this.setCDNPath=e=>(this.cdnPath=e,this),this.setDirectoryPath=(e,t=!0)=>(this.directoryPath=e,this.forceCreateDirectory=t,this),this.setFormData=e=>(this.formData=e,this),this.enablePageLoader=function(e=!1){return this.showPageLoader=e,this},this.setBucketKey=e=>{this.bucketId=e,this.GateWayConfigObj.bucketConfig=[];let t={bucketId:e};return this.GateWayConfigObj.bucketConfig.push(t),this},this.setPurposeId=e=>(this.GateWayConfigObj.purposeId=e,this),this.setClientId=e=>(this.GateWayConfigObj.clientId=e,this),this.setUserId=e=>(this.GateWayConfigObj.userId=e,this);const c=(e="")=>new Promise((t=>{i({url:e,method:"GET",headers:r(),responseType:"blob",cancelToken:new d((function(e){}))}).then((e=>{this.fileName=(e=>{const t=decodeURIComponent(new URL(e).pathname),a=t.lastIndexOf("/");return-1!==a?t.substring(a+1):t})(this.cdnURL);const t=window.URL.createObjectURL(new Blob([e.data],{type:"application/octet-stream"}));var a=document.createElement("a");a.href=t,a.download=this.fileName,a.target="_blank",a.click()})).catch((e=>{console.log("fail error",e.message);let n={data:{}};this.showPageLoader&&this.mainStore.MUTATE_PAGE_BLOCKER(!1),n.data.error=e.message,n.data.errorCode=1990,n.data.result=null,t(new a(n))}))})).catch((e=>{console.log(e),alert(e)}));this.uploadFile=(e=null)=>{this.cdnURL="/uploadfile";let t={data:{}};return this.savedConfig.jwtKey="",this.savedConfig.isPrivateBucket=!0,o(this.savedConfig),new Promise((n=>{m(e,this.cdnURL).then((e=>{t.data=e.raw,n(new a(t))}))}))},this.deleteFile=(e=null)=>{this.cdnURL="/deletefile";let t={data:{}};return this.savedConfig.jwtKey="",this.savedConfig.isPrivateBucket=!0,o(this.savedConfig),new Promise((n=>{h(e,this.cdnURL).then((e=>{t.data=e.raw,n(new a(t))}))}))},this.downloadFile=(e=null)=>{let t="";return this.showPageLoader&&this.mainStore.MUTATE_PAGE_BLOCKER(!0),null!==e&&null!==document.getElementById(e)&&(t=document.getElementById(e).innerHTML,document.getElementById(e).disabled=!0,document.getElementById(e).innerHTML="Processing"),new Promise((a=>{this.cdnPath.includes("http://")||this.cdnPath.includes("https://")?(this.cdnURL=this.cdnPath,c(this.cdnURL).then((e=>{a(e)}))):(this.cdnURL=window.location.origin+n.getCDNBaseURL()+"/"+this.cdnPath,c(this.cdnURL).then((e=>{a(e)}))),this.showPageLoader&&this.mainStore.MUTATE_PAGE_BLOCKER(!1),null!==e&&null!==document.getElementById(e)&&(document.getElementById(e).disabled=!1,document.getElementById(e).innerHTML=t)})).catch((e=>{alert(e)}))}}}export{d as M};
//# sourceMappingURL=mqlCdn-bafb9aaf.js.map
