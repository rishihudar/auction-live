import{_ as e,aj as t,aY as l,a9 as a,d as o,R as s,C as i,r as n,o as r,e as u,b as d,t as m,c,g as p,F as v,J as w,a as f,w as g,M as S,f as y,u as I,H as k,A as D}from"./index-4336d1e5.js";import{u as h,r as A}from"./index-d2775270.js";import j from"./AuctionPreview-19235c1a.js";import"./History-58a299e3.js";import"./Step1-4a918314.js";import"./dividerstyle.esm-95cf4cf0.js";import"./helpers-8a92585b.js";import"./Step2-89b93416.js";import"./Step3-3827dab0.js";import"./fileupload.esm-829aa14d.js";import"./mqlCdn-bafb9aaf.js";import"./eye-ba8d269b.js";import"./Step4-74d95733.js";import"./calendar.esm-4e16d4c8.js";import"./index.esm-5cb62265.js";const F={class:""},b={key:0,class:"ml-auto"},V={class:"p-buttonset"},x={key:0,class:"p-text-secondary block mb-5"},N=d("label",{for:"comment",class:"font-semibold w-6rem"},"Comment",-1),q={key:1,class:"fm-error"},L=d("br",null,null,-1),M={key:2,for:"login",class:"font-semibold w-6rem"},R={class:"flex justify-content-end gap-2"},C=e({__name:"ViewAuction",props:{workflowStepDetailsId:{type:Number,required:!0,default:null}},setup(e){const C=D({position:"top-right",duration:3e3}),W=t();l();const _=a(),U=o(!1),K=o(null),T=o({}),E=o([]),P=o({}),$=o(),{workflowStepDetailsId:H}=e,J=async e=>{P.value=e,await new Promise(((e,t)=>{(new S).useManagementServer().setActivity("o.[FetchRoleAndLoginFormNextStepAndStatus]").setData({fromStatusId:P.value.statusId,fromWorkflowStepId:O.value.workflowStepId,entityId:W.entityId}).fetch().then((t=>{let l=t.getActivity("FetchRoleAndLoginFormNextStepAndStatus",!0);console.log(l),t.isValid("FetchRoleAndLoginFormNextStepAndStatus")?(E.value=l.result.nextLogins,T.value.roleName=l.result.nextRole.displayName,T.value.roleId=l.result.nextRole.roleId,e()):t.showErrorToast("FetchRoleAndLoginFormNextStepAndStatus")}))})),console.log("Here"),U.value=!0},B=o(),O=o({}),Y=o(null);let z=s((()=>({comment:{required:A}})));const G=h(z,{comment:K}),Q=s((()=>O.value.assignedRoleId==W.currentRole.roleId&&(!O.value.assignedLoginId||O.value.assignedLoginId==W.loginId)));async function X(){const e=await G.value.$validate();if(console.log(e),!e)return void C.error("Please Add Comment");let t={assignedLoginId:Y.value,assignedRoleId:T.value.roleId,comment:K.value,loginId:W.loginId,roleId:W.currentRole.roleId,workflowStatusId:P.value.statusId,workflowStepDetailsId:H,workflowStepId:O.value.workflowStepId};(new S).useManagementServer().setActivity("o.[UpdateWorkflowStepDetails]").setData(t).fetch().then((e=>{e.getActivity("UpdateWorkflowStepDetails",!0),e.isValid("UpdateWorkflowStepDetails")?_.push({name:W.role.roleCode}):e.showErrorToast("UpdateWorkflowStepDetails")}))}return i((async()=>{await new Promise(((e,t)=>{(new S).useManagementServer().setActivity("o.[query_2cg9Wj6KVFlFt8DMt6va6a4tjqm]").setData({workflowStepDetailsId:H}).fetch().then((l=>{let a=l.getActivity("query_2cg9Wj6KVFlFt8DMt6va6a4tjqm",!0);l.isValid("query_2cg9Wj6KVFlFt8DMt6va6a4tjqm")?(console.log(a),O.value=a[0],O.value.data1=JSON.parse(O.value.data1),$.value=O.value.auctionId,e()):(l.showErrorToast("query_2cg9Wj6KVFlFt8DMt6va6a4tjqm"),t())}))})),(new S).useManagementServer().setActivity("o.[FetchAuctionDetailsForView]").setData({workflowStepDetailsId:H}).fetch().then((e=>{let t=e.getActivity("FetchAuctionDetailsForView",!0);console.log(t,"result"),e.isValid("FetchAuctionDetailsForView")?B.value=t.result.NextStatus:e.showErrorToast("FetchAuctionDetailsForView")}))})),(t,l)=>{const a=n("Button"),o=n("InputText"),s=n("Dialog");return r(),u(v,null,[d("div",F,[d("div",null,[d("h6",null,m(O.value.displayName),1)]),e.workflowStepDetailsId&&$.value?(r(),c(j,{key:0,workflowStepDetailsId:e.workflowStepDetailsId,auctionId:$.value,config:O.value.data1},null,8,["workflowStepDetailsId","auctionId","config"])):p("",!0)]),d("div",null,[Q.value?(r(),u("div",b,[d("span",V,[(r(!0),u(v,null,w(B.value,(e=>(r(),c(a,{onClick:t=>J(e),label:e.statusDisplayName,key:e.statusId},null,8,["onClick","label"])))),128))])])):p("",!0),f(s,{visible:U.value,"onUpdate:visible":l[3]||(l[3]=e=>U.value=e),modal:"",header:P.value.statusDisplayName,style:{width:"25rem"}},{default:g((()=>[0==O.value.endStep?(r(),u("span",x,[y("Assign to "),d("strong",null,m(T.value.roleName),1)])):p("",!0),N,f(o,{id:"comment",modelValue:K.value,"onUpdate:modelValue":l[0]||(l[0]=e=>K.value=e),class:"flex-auto",autocomplete:"off"},null,8,["modelValue"]),I(G).comment.$error?(r(),u("small",q,m(I(G).comment.$errors[0].$message),1)):p("",!0),L,0==O.value.endStep?(r(),u("label",M,"Login")):p("",!0),0==O.value.endStep?(r(),c(I(k),{key:3,modelValue:Y.value,"onUpdate:modelValue":l[1]||(l[1]=e=>Y.value=e),options:E.value,optionLabel:"fullName",optionValue:"userId",placeholder:"Select a Login",class:"w-full md:w-14rem mb-3"},null,8,["modelValue","options"])):p("",!0),d("div",R,[f(a,{type:"button",label:"Cancel",severity:"secondary",onClick:l[2]||(l[2]=e=>U.value=!1)}),f(a,{type:"button",label:P.value.statusDisplayName,onClick:X},null,8,["label"])])])),_:1},8,["visible","header"])])],64)}}},[["__file","D:/acution-live/auction-server/auction-live/src/views/WorkflowManagement/ViewAuction.vue"]]);export{C as default};
//# sourceMappingURL=ViewAuction-35d57938.js.map
