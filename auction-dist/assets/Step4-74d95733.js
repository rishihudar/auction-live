import{_ as e,B as a,a9 as l,aj as t,aq as o,d as s,R as n,C as i,ah as r,o as u,e as c,b as d,t as v,a as m,u as p,g as f,w as D,M as h,E as g,p as w,m as y,A as S}from"./index-4336d1e5.js";import{h as A,s as I}from"./calendar.esm-4e16d4c8.js";import{s as b}from"./fileupload.esm-829aa14d.js";import{M as P}from"./mqlCdn-bafb9aaf.js";import{f as U}from"./helpers-8a92585b.js";import{u as N,c as T,r as M}from"./index-d2775270.js";import"./index.esm-5cb62265.js";const E=e=>(w("data-v-d752779b"),e=e(),y(),e),V={class:"wizard-content"},C={class:"wc-item"},x={class:"wc-header"},F={class:"wc-title"},Y={class:"form-grid"},k={class:"col-span-full md:col-span-6"},O={class:"fm-group"},_=E((()=>d("label",{class:"fm-label",for:"calendar-12h"}," Processing Fee And EMD payment Start Date ",-1))),H={class:"fm-inner"},j={key:0,class:"col-span-full fm-error"},q={class:"col-span-full md:col-span-6"},R={class:"fm-group"},z=E((()=>d("label",{class:"fm-label",for:"calendar-12h"}," Processing Fee And EMD payment End Date ",-1))),B={class:"fm-inner"},L={class:"col-span-full 2xl:col-span-6"},$={class:"fm-group"},K=E((()=>d("label",{class:"fm-label"}," Auction Document ",-1))),W={class:"fm-inner"},J={key:0,class:"text-red-500"},G={key:1},Q={class:"col-span-full 2xl:col-span-6"},X={class:"fm-group"},Z=E((()=>d("label",{class:"fm-label"}," Notice Document ",-1))),ee={class:"fm-inner"},ae={key:0,class:"text-red-500"},le={key:1},te={class:"wc-action"},oe=e({__name:"Step4",props:{auctionId:{type:Number,default:null},config:{type:Object,default:null}},emits:{nextTab:null,previousTab:null},setup(e,{emit:w}){const y=S({position:"top-right",duration:5e3}),E=a(),oe=l(),se=t(),ne=o(),{auctionId:ie,config:re}=e,ue=s(),ce=s(),de=s(),ve=window.app,me=s();me.value=A().add(1,"minutes").toDate();const pe=s();pe.value=A().add(2,"minutes").toDate();const fe=s(),De=s(),he=s(),ge=s([]),we=s(),ye=s(),Se=s(),Ae=s(),Ie=s(),be=s(),Pe=s(),Ue=s(),Ne=s(),Te=s(),Me=s(),Ee=s([]),Ve=s(),Ce=s(),xe=s(),Fe=s(),Ye=s(),ke=n((()=>({AucUrl:{required:T.withMessage("Document is required",M)},NoticeUrl:{required:T.withMessage("Document is required",M)}}))),Oe=N(ke,{AucUrl:fe,NoticeUrl:De}),_e=w;const He=async(e,a)=>{console.log(e,"event");let l=Date.now();console.log(l,"timeStamp"),console.log("event",e.files[0]),he.value=e.files[0].name,console.log("myFile",he.value);const t=new FormData;t.append("file",e.files[0]),(new P).enablePageLoader(!0).setDirectoryPath(ie+"/AuctionPreparation/Publishing").setFormData(t).setFileName(l+"_"+he.value).setBucketKey("2ciy8jTCjhcc6Ohu2hGHyY16nHn").setPurposeId("2cixqU1nhJHru2m1S0uIxdKSgMb").setClientId("2cixqU1nhJHru2m1S0uIxdKSgMb").uploadFile("uploadtBtn").then((e=>{e.isValid()?(xe.value=l+"_"+he.value,Fe.value=e.uploadedFileURL().filePath,Ye.value=ve.getCDNBaseURL(),console.log("fileName",xe.value),console.log("filePath",Fe.value),console.log("fullPath",Ye.value),8==a?(fe.value=Fe.value,console.log("AucUrl",fe.value)):(De.value=Fe.value,console.log("NoticeUrl",De.value)),Ee.value.push({fileName:l+"_"+he.value,filePath:e.uploadedFileURL().filePath,fullPath:e.uploadedFileURL().cdnServer+"/"+e.uploadedFileURL().filePath,documentTypeId:a}),Ne.value=a,console.log("id-",Ne.value),8==a?we.value=!0:Ae.value=!0,y.success("File Uploaded !!!")):e.showErrorToast()}))};async function je(){let e=await Oe.value.$validate();console.log("here",e),e&&(console.log("Inside checkDates"),A(de.value).isSameOrBefore(ce.value,"minute")?(E.add({severity:"error",summary:"Error",detail:"An error occurred.",life:5e3}),alert("Start Date should not be equal or after End Date !")):(await async function(){let e;const a=await U("AUCTION_COMPLETED");return null==a.error?e=a.result.statusId:y.error("Oops! Please Contact Support"),new Promise((a=>{(new h).useManagementServer().setActivity("o.[step4UpdateDatesAndUploadDocuments]").setData({registrationStartDate:A(ce.value).format("YYYY/MM/DD HH:mm:ss"),registrationEndDate:A(de.value).format("YYYY/MM/DD HH:mm:ss"),auctionId:ie,statusId:e}).fetch().then((e=>{let l=e.getActivity("step4UpdateDatesAndUploadDocuments",!0);e.isValid("step4UpdateDatesAndUploadDocuments")?(console.log("res.result",l.result),a()):e.showErrorToast("step4UpdateDatesAndUploadDocuments")}))}))}(),await async function(){return new Promise(((e,a)=>{(new h).useManagementServer().setActivity("o.[InsertDocumentPathStep4]").setData({auctionId:ie,documentsArray:Ee.value}).fetch().then((a=>{a.getActivity("InsertDocumentPathStep4",!0),a.isValid("InsertDocumentPathStep4")?e():a.showErrorToast("InsertDocumentPathStep4")})).catch((e=>{a(e)}))}))}(),y.success(" Data Saved !!!"),null==re&&await async function(){var e;const a=await U("AUCTION_COMPLETED");return null==a.error?e=a.result.statusId:y.error("Oops! Please contact Support"),new Promise(((a,l)=>{console.log(e);var t={assignedLoginId:null,assignedRoleId:se.role.roleId,auctionId:ie,comment:"Auction Completed",entityId:se.entityId,loginId:se.loginId,organisationId:se.organizationId,roleId:se.role.roleId,statusId:e};(new h).setActivity("o.[InsertWorkflowStepDetails]").useManagementServer().setData(t).fetch().then((e=>{let t=e.getActivity("InsertWorkflowStepDetails",!0);e.isValid("InsertWorkflowStepDetails")?a():(e.showErrorToast("InsertWorkflowStepDetails"),l(t.error))}))}))}()),ne.$reset(),null!=re?_e("nextTab"):oe.push({name:se.role.roleCode}))}function qe(e){""!==e?(new P).setCDNPath(e).enablePageLoader(!0).downloadFile("downloadBtn").then((e=>{e.isValid()||e.showErrorToast()})):y.error("File can'nt be downloaded!")}return i((()=>{(new h).useCoreServer().setActivity("o.[fetchDocumentsValidationDetails]").fetch().then((e=>{let a=e.getActivity("fetchDocumentsValidationDetails",!0);ge.value=a.result.validation,ge.value.forEach((e=>{"AUCTION_DOCUMENT"==e.typeName?(we.value=e.typeName,Se.value=e.fileSize,ye.value=e.fileType,Me.value=e.typeId,console.log("docName.value",we.value),console.log("AuctionDocTypeId.value",Me.value)):"NOTICE_DOCUMENT"==e.typeName&&(Ae.value=e.typeName,be.value=e.fileSize,Ie.value=e.fileType,Te.value=e.typeId,console.log("docName.value",Ae.value),console.log("NoticeDocTypeId.value",Te.value))})),e.isValid("fetchDocumentsValidationDetails")||e.showErrorToast("fetchDocumentsValidationDetails")})),Ce.value=A(ue.value).add(120,"seconds").format("YYYY/MM/DD HH:mm:ss"),console.log("formattedEndDate.value",Ce.value),Ve.value=A(ue.value).add(60,"seconds").format("YYYY/MM/DD HH:mm:ss"),console.log("formattedStartDate.value",Ve.value),(new h).useManagementServer().setActivity("o.[getServerDate]").setData({}).fetch().then((e=>{let a=e.getActivity("getServerDate",!0);ue.value=a.result.serverDate.currentDate,console.log("serverDate-",ue.value),e.isValid("getServerDate")||e.showErrorToast("getServerDate")}))})),r((()=>{(new h).useManagementServer().setActivity("o.[FetchAllStepsAuctionPreview]").setData({auctionId:ie}).fetch().then((e=>{let a=e.getActivity("FetchAllStepsAuctionPreview",!0);0==a.result.fetchStep4AuctionPreview.length||null==a.result.fetchStep4AuctionPreview[0].startDate||null==a.result.fetchStep4AuctionPreview[0].endDate?(ce.value=Ve.value,de.value=Ce.value,console.log("formattedStartDate.value",Ve.value)):(Ue.value=a.result.fetchStep4AuctionPreview[0].startDate,Pe.value=a.result.fetchStep4AuctionPreview[0].endDate,ce.value=Ue.value,de.value=Pe.value),e.isValid("FetchAllStepsAuctionPreview")||e.showErrorToast("FetchAllStepsAuctionPreview")}))})),(a,l)=>{var t,o,s,n;return u(),c("div",V,[d("div",C,[d("div",x,[d("div",F,"Auction ID: "+v(e.auctionId),1)]),d("div",Y,[d("div",k,[d("div",O,[_,d("div",H,[m(p(I),{disabled:null==(t=e.config)?void 0:t.selectedStartDateReadonly,id:"calendar-24h",modelValue:ce.value,"onUpdate:modelValue":l[0]||(l[0]=e=>ce.value=e),showTime:"",hourFormat:"24",minDate:me.value,showIcon:!0},null,8,["disabled","modelValue","minDate"])]),p(A)(de.value).isSameOrBefore(ce.value,"minute")?(u(),c("div",j," Start Date should not be equal or after End Date ! ")):f("",!0)])]),d("div",q,[d("div",R,[z,d("div",B,[m(p(I),{disabled:null==(o=e.config)?void 0:o.selectedEndDateReadonly,id:"calendar",modelValue:de.value,"onUpdate:modelValue":l[1]||(l[1]=e=>de.value=e),showTime:"",hourFormat:"24",minDate:pe.value,showIcon:!0},null,8,["disabled","modelValue","minDate"])])])]),d("div",L,[d("div",$,[K,d("div",W,[m(p(b),{disabled:null==(s=e.config)?void 0:s.docNameReadonly,modelValue:we.value,"onUpdate:modelValue":l[2]||(l[2]=e=>we.value=e),accept:ye.value,multiple:!1,"max-file-size":1e3*Se.value,"custom-upload":!0,onUploader:l[3]||(l[3]=e=>He(e,Me.value))},{empty:D((()=>[d("p",null," Drag and drop files here to upload, Max. file size is 500 KB, Only "+v(ye.value)+" are allowed ! ",1)])),_:1},8,["disabled","modelValue","accept","max-file-size"]),p(Oe).AucUrl.$error?(u(),c("span",J,v(p(Oe).AucUrl.$errors[0].$message),1)):f("",!0),fe.value?(u(),c("div",G,[m(p(g),{label:"Download Auction Document",onClick:l[4]||(l[4]=e=>qe(fe.value))})])):f("",!0)])])]),d("div",Q,[d("div",X,[Z,d("div",ee,[m(p(b),{disabled:null==(n=e.config)?void 0:n.NoticeDocNameReadonly,modelValue:Ae.value,"onUpdate:modelValue":l[5]||(l[5]=e=>Ae.value=e),accept:Ie.value,multiple:!1,"max-file-size":1e3*be.value,"custom-upload":!0,onUploader:l[6]||(l[6]=e=>He(e,Te.value))},{empty:D((()=>[d("p",null," Drag and drop files here to upload, Max. file size is 500 KB, Only "+v(ye.value)+" are allowed ! ",1)])),_:1},8,["disabled","modelValue","accept","max-file-size"]),p(Oe).NoticeUrl.$error?(u(),c("span",ae,v(p(Oe).NoticeUrl.$errors[0].$message),1)):f("",!0),De.value?(u(),c("div",le,[m(p(g),{label:"Download Notice Document",onClick:l[7]||(l[7]=e=>qe(De.value))})])):f("",!0)])])])])]),d("div",te,[m(p(g),{label:"Back",onClick:l[8]||(l[8]=e=>{_e("previousTab")}),severity:"secondary"}),m(p(g),{label:"Save",onClick:je,class:"btn-submit"})])])}}},[["__scopeId","data-v-d752779b"],["__file","D:/acution-live/auction-server/auction-live/src/views/admin/AuctionPreparation/Step4.vue"]]);export{oe as default};
//# sourceMappingURL=Step4-74d95733.js.map
